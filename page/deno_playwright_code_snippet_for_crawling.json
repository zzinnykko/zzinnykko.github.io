{"title":"deno + playwright 으로 사이트 크롤링 코드 조각","updated":"2026-01-23","content":"<article class=\"page\"><h1 id=\"page-title\">deno + playwright 으로 사이트 크롤링 코드 조각</h1><div class=\"text-right\">Last updated: 2026-01-23</div><div class=\"markdown-body\"><p>deno 런타임으로 playwright 사용, edge 자동화 하면서 겪은 상황들과 이를 해결했던 방법과 코드 모음</p>\n<p>나 혼자 사용이 아닌, 개발에 대해 전혀 모르는 사용자들이 그나마 편하게 사용할 수 있도록 하기 위해, exe 배포가 편한 deno 사용, 최신 윈도우라면 무조건 설치가 되어있는 edge 브라우저 자동화 및 크롤링 진행</p>\n<h2>특정 element 클릭</h2>\n<p>playwright 에서 셀렉터 통해 element 지정한 뒤 클릭할 수 있으나, 클릭 위치가 동일하고 코드가 동일해도 어떤 경우는 클릭, 어떤 경우는 클릭 안되고 작동 멈춰버리는 현상 발생</p>\n<p>아래 코드로 클릭 자동화했더니 현재까지 문제없이 일관되게 잘 작동하였음</p>\n<p>ai 질의 통해, javascript 주입을 통해 웹브라우저가 스스로 클릭을 하도록 만드는 방법을 사용</p>\n<pre><code class=\"hljs language-TypeScript\"><span class=\"hljs-keyword\">const</span> btn = page.<span class=\"hljs-title function_\">locator</span>(<span class=\"hljs-string\">&quot;.btn&quot;</span>).<span class=\"hljs-title function_\">first</span>();\n<span class=\"hljs-keyword\">await</span> btn.<span class=\"hljs-title function_\">waitFor</span>({ <span class=\"hljs-attr\">state</span>: <span class=\"hljs-string\">&#x27;attached&#x27;</span> });\n<span class=\"hljs-keyword\">await</span> btn.<span class=\"hljs-title function_\">evaluate</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\"><span class=\"hljs-attr\">el</span>: <span class=\"hljs-title class_\">HTMLElement</span></span>) =&gt;</span> el.<span class=\"hljs-title function_\">click</span>());\n<span class=\"hljs-keyword\">await</span> page.<span class=\"hljs-title function_\">locator</span>(<span class=\"hljs-string\">&quot;.result&quot;</span>).<span class=\"hljs-title function_\">first</span>().<span class=\"hljs-title function_\">waitFor</span>();\n</code></pre>\n<h2>allInnerTexts 또는 allTextContents 함수 에러</h2>\n<p>locator 로 지정한 모든 요소들의 내부 텍스트를 배열로 반환해주는 편리한 함수인데, 경우에 따라 &quot;TypeError: this._engines.set is not a function&quot; 에러가 발생</p>\n<p>ai 한테 물어보면 뭐라뭐라하는데 결국 해결방법이 없어서 그냥 무식하게 처리</p>\n<pre><code class=\"hljs language-TypeScript\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">temp</span>: <span class=\"hljs-built_in\">string</span>[] = [];\n<span class=\"hljs-keyword\">const</span> td = page.<span class=\"hljs-title function_\">locator</span>(<span class=\"hljs-string\">&quot;td&quot;</span>);\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>, count = <span class=\"hljs-keyword\">await</span> td.<span class=\"hljs-title function_\">count</span>(); i &lt; count; i++) {\n    temp.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-keyword\">await</span> td.<span class=\"hljs-title function_\">nth</span>(i).<span class=\"hljs-title function_\">innerText</span>());\n}\n</code></pre>\n<h2>문자열을 csv 형식에 유효한 문자열로 치환</h2>\n<p>csv 형식은 <code>,</code> 로 각 요소를 구분함, 구분자로서가 아닌 실제로 콤마가 포함된 문자열은 앞 뒤로 쌍따옴표를 사용, 행을 구분하기 위한 줄바꿈이 아닌 실제 줄바꿈이 포함된 문자열도 앞 뒤로 쌍따옴표를 사용</p>\n<p>따라서, <code>\\n</code>, <code>&quot;</code>, <code>,</code> 세개 문자가 포함된 문자열은 쌍따옴표를 앞 뒤로 넣어야 함</p>\n<p>다만 일반적인 데이터 처리에 있어서 개행의 경우 그냥 빈칸으로 치환해도 무방한 경우가 많아, 개행을 포함한 공백은 모두 하나의 공백으로만 바꾸고, 쌍따옴표와 콤마의 경우만 쌍따옴표를 붙이는 처리함</p>\n<p>ai 가 알려준 아래 코드를 사용</p>\n<pre><code class=\"hljs language-TypeScript\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">convCsvStr</span>(<span class=\"hljs-params\"><span class=\"hljs-attr\">s</span>: <span class=\"hljs-built_in\">string</span></span>): <span class=\"hljs-built_in\">string</span> {\n    <span class=\"hljs-keyword\">let</span> x = s.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-regexp\">/\\s+/g</span>, <span class=\"hljs-string\">&quot; &quot;</span>).<span class=\"hljs-title function_\">trim</span>();\n    <span class=\"hljs-keyword\">if</span> (x.<span class=\"hljs-title function_\">includes</span>(<span class=\"hljs-string\">&quot;,&quot;</span>) || x.<span class=\"hljs-title function_\">includes</span>(<span class=\"hljs-string\">&#x27;&quot;&#x27;</span>)) {\n        x = <span class=\"hljs-string\">&#x27;&quot;&#x27;</span> + x.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-regexp\">/&quot;/g</span>, <span class=\"hljs-string\">&#x27;&quot;&quot;&#x27;</span>) + <span class=\"hljs-string\">&#x27;&quot;&#x27;</span>;\n    }\n    <span class=\"hljs-keyword\">return</span> x;\n}\n</code></pre>\n</div></article>"}
